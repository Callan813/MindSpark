<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Manager</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      :root {
        --bg-color: #f4f4f4;
        --text-color: #333;
        --btn-color: #28a745;
        --btn-hover: #218838;
        --container-bg: white;
        --nav-bg: white;
        --border-color: #ddd;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --logo-color: #4a90e2;
      }

      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        padding-top: 80px;
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: all 0.3s ease;
      }

      .navbar {
        background: var(--nav-bg);
        box-shadow: 0 2px 10px var(--shadow-color);
        padding: 1rem 2rem;
        position: fixed;
        width: 100%;
        top: 0;
        left: 0;
        z-index: 1000;
        box-sizing: border-box;
      }

      .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--logo-color);
        text-decoration: none;
      }

      .nav-links {
        display: flex;
        gap: 2rem;
      }

      .nav-links a {
        text-decoration: none;
        color: var(--text-color);
        font-weight: 500;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        transition: all 0.3s ease;
      }

      .nav-links a:hover {
        background: var(--bg-color);
        color: var(--btn-color);
      }

      .icon {
        margin-right: 8px;
        font-size: 1.2em;
      }

      .file-manager {
        max-width: 1000px;
        margin: 20px auto;
        padding: 20px;
        background: var(--container-bg);
        border-radius: 8px;
        box-shadow: 0 0 10px var(--shadow-color);
      }

      .folder,
      .file {
        background: var(--container-bg);
        border: 1px solid var(--border-color);
        margin: 10px 0;
        padding: 15px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .folder:hover,
      .file:hover {
        background: var(--bg-color);
        transform: translateY(-2px);
        box-shadow: 0 2px 8px var(--shadow-color);
      }

      .upload-btn {
        background: var(--btn-color);
        color: white;
        border: none;
        padding: 5px 15px;
        border-radius: 4px;
        cursor: pointer;
        margin-left: auto;
      }

      .upload-btn:hover {
        background: var(--btn-hover);
      }

      .floating-button {
        position: fixed;
        right: 20px;
        background-color: var(--btn-color);
        color: white;
        border: none;
        padding: 0 20px;
        height: 40px;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 2px 2px 10px var(--shadow-color);
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
        transition: all 0.3s ease;
      }

      .floating-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px var(--shadow-color);
      }

      .notes-button {
        bottom: 20px;
        background-color: #2196f3; /* Blue color for distinction */
      }

      .notes-button::before {
        content: "üìù";
        font-size: 20px;
      }

      .notes-button::after {
        content: "Quick Notes";
        color: white;
        font-weight: 500;
      }

      .notes-popup {
        bottom: 70px;
        right: 20px;
        width: 300px;
        height: 300px;
        background: var(--container-bg);
        border-radius: 8px;
        box-shadow: 2px 2px 10px var(--shadow-color);
        display: none;
        flex-direction: column;
        padding: 15px;
        z-index: 1000;
        border: 1px solid var(--border-color);
      }

      .notes-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: bold;
        margin-bottom: 10px;
        color: var(--text-color);
      }

      .notes-header button {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
        color: var(--text-color);
      }

      #notesText {
        width: 100%;
        height: calc(100% - 30px);
        border: 1px solid var(--border-color);
        resize: none;
        outline: none;
        padding: 10px;
        border-radius: 4px;
        background: var(--container-bg);
        color: var(--text-color);
      }

      #file-list {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        padding: 0;
        list-style: none;
      }

      .folder,
      .file {
        width: 120px;
        height: 140px;
        padding: 10px;
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        background: var(--container-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .folder:hover,
      .file:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px var(--shadow-color);
      }

      .folder img,
      .file img {
        width: 48px;
        height: 48px;
        margin-bottom: 8px;
      }

      .folder span,
      .file span {
        font-size: 0.9em;
        word-break: break-word;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }

      .file-count {
        font-size: 0.8em;
        color: var(--text-secondary);
        margin-top: 4px;
      }

      .add-file-btn {
        width: 120px;
        height: 140px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border: 2px dashed var(--border-color);
        border-radius: 8px;
        cursor: pointer;
        background: transparent;
        color: var(--text-color);
        transition: all 0.3s ease;
      }

      .add-file-btn:hover {
        background: var(--bg-color);
        border-color: var(--btn-color);
        color: var(--btn-color);
      }

      .add-file-btn i {
        font-size: 24px;
        margin-bottom: 8px;
      }

      .file-viewer {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1001;
      }

      .file-viewer-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--container-bg);
        padding: 20px;
        border-radius: 8px;
        max-width: 80%;
        max-height: 80vh;
        overflow: auto;
      }

      .file-viewer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .file-viewer-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-color);
      }

      .file-content {
        white-space: pre-wrap;
        user-select: text;
        font-family: monospace;
        line-height: 1.5;
        padding: 15px;
        background: var(--bg-color);
        border-radius: 4px;
      }

      .file-content img {
        max-width: 100%;
        height: auto;
      }

      ::selection {
        background: var(--btn-color);
        color: white;
      }

      .file-actions {
        display: none;
        position: absolute;
        top: 5px;
        right: 5px;
        background: var(--container-bg);
        border-radius: 4px;
        box-shadow: 0 2px 8px var(--shadow-color);
      }

      .file:hover .file-actions,
      .folder:hover .file-actions {
        display: flex;
      }

      .action-btn {
        background: none;
        border: none;
        padding: 4px 8px;
        cursor: pointer;
        color: var(--text-color);
        transition: all 0.2s ease;
      }

      .action-btn:hover {
        color: #dc3545;
      }

      .file,
      .folder {
        position: relative;
      }

      .delete-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1002;
        justify-content: center;
        align-items: center;
      }

      .delete-modal-content {
        background: var(--container-bg);
        padding: 20px;
        border-radius: 8px;
        max-width: 400px;
        width: 90%;
        text-align: center;
      }

      .delete-modal-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
      }

      .delete-btn {
        background: #dc3545;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
      }

      .cancel-btn {
        background: var(--btn-color);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
      }

      .upload-section {
        width: 100%;
        height: 300px;
        display: flex;
        justify-content: center;
        align-items: center;
        border: 2px dashed var(--border-color);
        border-radius: 8px;
        margin: 20px 0;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .upload-section:hover {
        border-color: var(--btn-color);
        background: var(--bg-color);
      }

      .upload-container {
        text-align: center;
        color: var(--text-color);
      }

      .upload-container i {
        font-size: 48px;
        color: var(--btn-color);
        margin-bottom: 15px;
      }

      .upload-container h3 {
        margin: 10px 0;
        font-weight: normal;
      }

      .upload-container p {
        color: var(--text-secondary);
        font-size: 0.9em;
      }

      .upload-btn-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
      }

      .upload-btn-container:hover {
        border-color: var(--btn-color);
        background: var(--bg-color);
      }

      .upload-btn-container i {
        font-size: 24px;
        margin-bottom: 8px;
        color: var(--btn-color);
      }

      #file-list {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        padding: 20px;
      }

      .floating-popup {
        display: none;
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 300px;
        background: var(--container-bg);
        border-radius: 8px;
        box-shadow: 0 4px 15px var(--shadow-color);
        z-index: 1000;
        animation: slideIn 0.5s ease-out;
        border: 1px solid var(--border-color);
      }

      @keyframes slideIn {
        from {
          transform: translateY(100%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .popup-content {
        padding: 15px;
      }

      .popup-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
      }

      .popup-header h3 {
        margin: 0;
        color: var(--text-color);
      }

      .close-popup {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-color);
        padding: 0;
        line-height: 1;
      }

      .popup-body {
        color: var(--text-color);
      }

      .popup-body ul {
        padding-left: 20px;
        margin: 10px 0;
      }

      .popup-body li {
        margin: 5px 0;
      }

      .popup-footer {
        margin-top: 15px;
        padding-top: 10px;
        border-top: 1px solid var(--border-color);
      }

      .popup-footer label {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-color);
        font-size: 0.9em;
      }

      .popup-footer input[type="checkbox"] {
        margin: 0;
      }

      .tasks-button {
        bottom: 90px;
        background-color: #4caf50;
      }

      .tasks-button::before {
        content: "üìã";
        font-size: 20px;
      }

      .tasks-button::after {
        content: "Open Tasks";
        color: white;
        font-weight: 500;
      }

      .tasks-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px var(--shadow-color);
      }

      .focus-mode {
        --bg-color: #1a1a1a;
        --text-color: #f5e6d3;
        --container-bg: #2d2d2d;
        --border-color: #404040;
        --shadow-color: rgba(0, 0, 0, 0.4);
      }

      #focusModeBtn {
        padding: 0.7rem 1.5rem;
        font-size: 1rem;
        border: none;
        border-radius: 25px;
        background: var(--btn-color);
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: auto;
        min-width: 140px;
        height: 40px;
        box-shadow: 0 2px 8px var(--shadow-color);
      }

      #focusModeBtn:hover {
        transform: translate(-50%, -2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      #focusModeBtn i {
        font-size: 1.1em;
        margin-right: 6px;
      }

      .webcam-status {
        margin-top: 1rem;
        display: none;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        color: var(--text-color);
        position: fixed;
        bottom: 70px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--container-bg);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        box-shadow: 0 2px 10px var(--shadow-color);
        font-size: 0.9rem;
        z-index: 1000;
      }

      .status-dot {
        width: 6px;
        height: 6px;
        background: #4caf50;
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-container">
        <a href="landing.html" class="logo">MindSpark</a>
        <div class="nav-links">
          <a href="pomodoro.html"><i class="fas fa-clock icon"></i>Pomodoro</a>
          <a href="calendar.html"
            ><i class="far fa-calendar icon"></i>Calendar</a
          >
          <a href="notes.html"><i class="far fa-sticky-note icon"></i>Notes</a>
          <a href="filemanager.html"><i class="far fa-folder icon"></i>Files</a>
        </div>
      </div>
    </nav>

    <div class="file-manager">
      <div id="folders-container">
        <ul id="file-list"></ul>
      </div>
    </div>

    <button id="openTasks" class="floating-button tasks-button"></button>
    <button id="openNotes" class="floating-button notes-button"></button>
    <button id="focusModeBtn" class="floating-button" style="bottom: 20px; left: 50%; transform: translateX(-50%);"><i class="fas fa-moon"></i> Focus Mode</button>
    <div id="notesPopup" class="notes-popup">
      <div class="notes-header">
        <span>Quick Notes</span>
        <button id="closeNotes">‚úñ</button>
      </div>
      <textarea
        id="notesText"
        placeholder="Write your notes here..."
      ></textarea>
    </div>

    <div class="file-viewer" id="fileViewer">
      <div class="file-viewer-content">
        <div class="file-viewer-header">
          <h3 id="fileViewerTitle"></h3>
          <button class="file-viewer-close" onclick="closeFileViewer()">
            √ó
          </button>
        </div>
        <div class="file-content" id="fileViewerContent"></div>
      </div>
    </div>

    <div class="delete-modal" id="deleteModal">
      <div class="delete-modal-content">
        <h3>Delete Confirmation</h3>
        <p>Are you sure you want to delete this item?</p>
        <div class="delete-modal-buttons">
          <button class="cancel-btn" onclick="cancelDelete()">Cancel</button>
          <button class="delete-btn" onclick="confirmDelete()">Delete</button>
        </div>
      </div>
    </div>

    <div id="floating-popup" class="floating-popup">
      <div class="popup-content">
        <div class="popup-header">
          <h3>Welcome!</h3>
          <button class="close-popup">&times;</button>
        </div>
        <div class="popup-body">
          <p>Welcome to the File Manager! Here you can:</p>
          <ul>
            <li>Create and organize folders</li>
            <li>Upload and manage files</li>
            <li>View files and documents</li>
            <li>Take quick notes</li>
          </ul>
          <div class="popup-footer">
            <label>
              <input type="checkbox" id="dont-show-again" /> Don't show this
              again
            </label>
          </div>
        </div>
      </div>
    </div>

    <div id="cameraStatus" class="webcam-status hidden" style="position: fixed; bottom: 60px; left: 50%; transform: translateX(-50%);">
      <span class="status-dot"></span>
      <span class="status-text">Webcam monitoring active</span>
    </div>

    <script>
      let fileSystem = [];
      let currentFolder = null;

      // Helper Functions
      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB", "TB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      function getFileIcon(filename) {
        const extension = filename.split(".").pop().toLowerCase();
        switch (extension) {
          case "pdf":
            return "https://cdn-icons-png.flaticon.com/128/337/337976.png";
          case "doc":
          case "docx":
            return "https://cdn-icons-png.flaticon.com/128/4722/4722830.png";
          case "xls":
          case "xlsx":
            return "https://cdn-icons-png.flaticon.com/128/4722/4722892.png";
          case "txt":
            return "https://cdn-icons-png.flaticon.com/128/4381/4381486.png";
          case "png":
          case "jpg":
          case "jpeg":
          case "gif":
            return "https://cdn-icons-png.flaticon.com/128/4381/4381492.png";
          default:
            return "https://cdn-icons-png.flaticon.com/128/4381/4381506.png";
        }
      }

      // Function to render files and folders
      function renderFiles() {
        const fileList = document.getElementById("file-list");
        fileList.innerHTML = "";

        if (currentFolder === null) {
          // Add the "Add Folder" button
          const addFolderBtn = document.createElement("button");
          addFolderBtn.className = "add-file-btn";
          addFolderBtn.innerHTML = `
            <i class="fas fa-folder-plus"></i>
            <span>New Folder</span>
          `;
          addFolderBtn.onclick = createNewFolder;
          fileList.appendChild(addFolderBtn);

          // Render folders
          fileSystem.forEach((item, index) => {
            const folderDiv = document.createElement("div");
            folderDiv.className = "folder";
            folderDiv.innerHTML = `
              <div class="file-actions">
                <button class="action-btn" onclick="event.stopPropagation(); showDeleteConfirmation('folder', ${index})">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
              <img src="https://cdn-icons-png.flaticon.com/128/3767/3767084.png" alt="Folder">
              <span>${item.name}</span>
              <span class="file-count">${item.files.length} files</span>
            `;
            folderDiv.onclick = () => openFolder(index);
            fileList.appendChild(folderDiv);
          });
        } else {
          // Add back button
          const backButton = document.createElement("button");
          backButton.className = "add-file-btn";
          backButton.innerHTML = `
            <i class="fas fa-arrow-left"></i>
            <span>Back</span>
          `;
          backButton.onclick = goBack;
          fileList.appendChild(backButton);

          // Add upload button
          const uploadButton = document.createElement("button");
          uploadButton.className = "add-file-btn";
          uploadButton.innerHTML = `
            <i class="fas fa-upload"></i>
            <span>Upload Files</span>
          `;
          uploadButton.onclick = () => handleFileUpload(currentFolder);
          fileList.appendChild(uploadButton);

          // Render files
          fileSystem[currentFolder].files.forEach((file, fileIndex) => {
            const fileDiv = document.createElement("div");   
            fileDiv.className = "file";
            fileDiv.innerHTML = `
              <div class="file-actions">
                <button class="action-btn" onclick="event.stopPropagation(); showDeleteConfirmation('file', ${fileIndex})">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
              <img src="${getFileIcon(file.name)}" alt="File">
              <span>${file.name}</span>
              <span class="file-size">${formatFileSize(file.size)}</span>
            `;
            fileDiv.onclick = () => viewFile(file);
            fileList.appendChild(fileDiv);
          });
        }
      }

      function createNewFolder() {
        const folderName = prompt("Enter folder name:");
        if (folderName && folderName.trim() !== "") {
          const newFolder = {
            name: folderName.trim(),
            files: [],
          };
          fileSystem.push(newFolder);
          localStorage.setItem("fileSystem", JSON.stringify(fileSystem));
          renderFiles();
        } else if (folderName !== null) {
          alert("Folder name cannot be empty.");
        }
      }

      function openFolder(index) {
        currentFolder = index;
        renderFiles();
      }

      function goBack() {
        currentFolder = null;
        renderFiles();
      }

      function handleFileUpload(folderIndex) {
        const input = document.createElement("input");
        input.type = "file";
        input.multiple = true;

        input.addEventListener("change", function (event) {
          const files = event.target.files;

          if (files.length === 0) return;

          for (const file of files) {
            const reader = new FileReader();

            reader.onload = function (e) {
              const newFile = {
                name: file.name,
                size: file.size,
                type: file.type,
                data: e.target.result,
              };

              fileSystem[folderIndex].files.push(newFile);
              updateFileSystemStorage();
              renderFiles();
            };

            if (file.type.startsWith("text/")) {
              reader.readAsText(file);
            } else {
              reader.readAsDataURL(file);
            }
          }
        });

        input.click();
      }

      // Add file viewer functions
      function viewFile(file) {
        const viewer = document.getElementById("fileViewer");
        const title = document.getElementById("fileViewerTitle");
        const content = document.getElementById("fileViewerContent");

        title.textContent = file.name;

        if (file.type.startsWith("image/")) {
          content.innerHTML = `<img src="${file.data}" alt="${file.name}">`;
        } else if (file.type === "application/pdf") {
          content.innerHTML = `<embed src="${file.data}" type="application/pdf" width="100%" height="600px">`;
        } else {
          content.innerHTML = `
      <pre id="textFileContent">${file.data}</pre>
      <button onclick="highlightSelection()">Highlight</button>
    `;
        }

        function highlightSelection() {
          const selection = window.getSelection();
          const selectedText = selection.toString();

          if (selectedText.length > 0) {
            const textContainer = document.getElementById("textFileContent");
            const newHtml = textContainer.innerHTML.replace(
              selectedText,
              `<mark>${selectedText}</mark>`
            );
            textContainer.innerHTML = newHtml;
          }
        }

        viewer.style.display = "block";
      }

      function closeFileViewer() {
        document.getElementById("fileViewer").style.display = "none";
      }

      document
        .getElementById("fileViewer")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeFileViewer();
          }
        });

      let itemToDelete = null;

      function showDeleteConfirmation(type, index) {
        itemToDelete = { type, index };
        document.getElementById("deleteModal").style.display = "flex";
      }

      function cancelDelete() {
        document.getElementById("deleteModal").style.display = "none";
        itemToDelete = null;
      }

      function confirmDelete() {
        if (!itemToDelete) return;

        const { type, index } = itemToDelete;

        if (type === "folder") {
          fileSystem.splice(index, 1);
        } else if (type === "file" && currentFolder !== null) {
          fileSystem[currentFolder].files.splice(index, 1);
        }

        localStorage.setItem("fileSystem", JSON.stringify(fileSystem));

        document.getElementById("deleteModal").style.display = "none";
        itemToDelete = null;

        renderFiles();
      }

      document
        .getElementById("deleteModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            cancelDelete();
          }
        });

      document.addEventListener("DOMContentLoaded", function () {
        const savedFileSystem = localStorage.getItem("fileSystem");
        if (savedFileSystem) {
          fileSystem = JSON.parse(savedFileSystem);
        }
        renderFiles();
      });

      function updateFileSystemStorage() {
        localStorage.setItem("fileSystem", JSON.stringify(fileSystem));
      }

      // Floating popup functionality
      const floatingPopup = document.getElementById("floating-popup");
      const closePopupBtn = floatingPopup.querySelector(".close-popup");
      const dontShowAgain = document.getElementById("dont-show-again");

      // Check if the user has chosen to not show the popup
      const shouldShowPopup =
        localStorage.getItem("hideWelcomePopup") !== "true";

      if (shouldShowPopup) {
        // Show popup after a short delay
        setTimeout(() => {
          floatingPopup.style.display = "block";
        }, 1000);
      }

      // Close popup
      closePopupBtn.addEventListener("click", () => {
        floatingPopup.style.display = "none";
        if (dontShowAgain.checked) {
          localStorage.setItem("hideWelcomePopup", "true");
        }
      });

      // Close on click outside
      document.addEventListener("click", (e) => {
        if (
          !floatingPopup.contains(e.target) &&
          floatingPopup.style.display === "block"
        ) {
          floatingPopup.style.display = "none";
          if (dontShowAgain.checked) {
            localStorage.setItem("hideWelcomePopup", "true");
          }
        }
      });

      document.addEventListener("DOMContentLoaded", function () {
        const tasksButton = document.getElementById("openTasks");

        tasksButton.addEventListener("click", function () {
          // Navigate to popup.html normally
          window.location.href = "popup.html";
        });
      });

      // Add JavaScript for focus mode
      document.getElementById("focusModeBtn").addEventListener("click", async function () {
        const cameraStatus = document.getElementById("cameraStatus");
        const isInFocusMode = document.body.classList.contains("focus-mode");

        if (!isInFocusMode) {
          try {
            // Request webcam access
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });

            // Apply focus mode theme
            document.body.classList.add("focus-mode");

            // Show camera status
            cameraStatus.style.display = "flex";

            // Change button text
            this.innerHTML = '<i class="fas fa-sun"></i> Exit Focus';

            // Store stream for later cleanup
            window.focusModeStream = stream;

            // Initialize drowsiness detection
            startDrowsinessDetection(stream);
          } catch (err) {
            alert("Please allow webcam access to use Focus Mode with drowsiness detection.");
            console.error("Error:", err);
          }
        } else {
          // Exit focus mode
          document.body.classList.remove("focus-mode");

          // Hide camera status
          cameraStatus.style.display = "none";

          // Change button text back
          this.innerHTML = '<i class="fas fa-moon"></i> Focus Mode';

          // Stop all tracks of the stream
          if (window.focusModeStream) {
            window.focusModeStream.getTracks().forEach((track) => track.stop());
            window.focusModeStream = null;
          }

          // Stop drowsiness detection
          stopDrowsinessDetection();
        }
      });

      function startDrowsinessDetection(stream) {
        console.log("Drowsiness detection started");
        // Implement drowsiness detection here
      }

      function stopDrowsinessDetection() {
        console.log("Drowsiness detection stopped");
        // Clean up any drowsiness detection resources here
      }
    </script>
    <script>
      function applyTheme(theme) {
        const root = document.documentElement;
        switch (theme) {
          case "dark":
            root.style.setProperty("--bg-color", "#1e1e1e");
            root.style.setProperty("--text-color", "#e0e0e0");
            root.style.setProperty("--btn-color", "#bb86fc");
            root.style.setProperty("--btn-hover", "#9965f4");
            root.style.setProperty("--container-bg", "#2d2d2d");
            root.style.setProperty("--nav-bg", "#2d2d2d");
            root.style.setProperty("--border-color", "#404040");
            root.style.setProperty("--shadow-color", "rgba(0, 0, 0, 0.3)");
            root.style.setProperty("--logo-color", "#bb86fc");
            // Reset background image
            document.body.style.backgroundImage = "none";
            break;

          case "blue":
            root.style.setProperty("--bg-color", "#e3f2fd");
            root.style.setProperty("--text-color", "#1a237e");
            root.style.setProperty("--btn-color", "#1976d2");
            root.style.setProperty("--btn-hover", "#1565c0");
            root.style.setProperty("--container-bg", "white");
            root.style.setProperty("--nav-bg", "#bbdefb");
            root.style.setProperty("--border-color", "#90caf9");
            root.style.setProperty("--shadow-color", "rgba(25, 118, 210, 0.2)");
            root.style.setProperty("--logo-color", "#1976d2");
            // Reset background image
            document.body.style.backgroundImage = "none";
            break;

          case "red":
            root.style.setProperty("--bg-color", "#ffebee");
            root.style.setProperty("--text-color", "#b71c1c");
            root.style.setProperty("--btn-color", "#d32f2f");
            root.style.setProperty("--btn-hover", "#c62828");
            root.style.setProperty("--container-bg", "white");
            root.style.setProperty("--nav-bg", "#ffcdd2");
            root.style.setProperty("--border-color", "#ef9a9a");
            root.style.setProperty("--shadow-color", "rgba(211, 47, 47, 0.2)");
            root.style.setProperty("--logo-color", "#d32f2f");
            // Reset background image
            document.body.style.backgroundImage = "none";
            break;

          case "squidgame":
            root.style.setProperty("--bg-color", "#000000");
            root.style.setProperty("--text-color", "#ffffff");
            root.style.setProperty("--btn-color", "#ff0000");
            root.style.setProperty("--btn-hover", "#cc0000");
            root.style.setProperty("--container-bg", "#1a1a1a");
            root.style.setProperty("--nav-bg", "#000000");
            root.style.setProperty("--border-color", "#ff0000");
            root.style.setProperty("--shadow-color", "rgba(255, 0, 0, 0.3)");
            root.style.setProperty("--logo-color", "#ff0000");
            // Add background image
            document.body.style.backgroundImage = "url('squid-game-bg.jpg')";
            document.body.style.backgroundSize = "cover";
            document.body.style.backgroundAttachment = "fixed";
            break;

          default: // light theme
            root.style.setProperty("--bg-color", "#f4f4f4");
            root.style.setProperty("--text-color", "#333");
            root.style.setProperty("--btn-color", "#28a745");
            root.style.setProperty("--btn-hover", "#218838");
            root.style.setProperty("--container-bg", "white");
            root.style.setProperty("--nav-bg", "white");
            root.style.setProperty("--border-color", "#ddd");
            root.style.setProperty("--shadow-color", "rgba(0, 0, 0, 0.1)");
            root.style.setProperty("--logo-color", "#4a90e2");
            // Reset background image
            document.body.style.backgroundImage = "none";
            break;
        }
      }

      // Initialize theme when page loads
      document.addEventListener("DOMContentLoaded", function () {
        const savedTheme = localStorage.getItem("appTheme");
        if (savedTheme) {
          applyTheme(savedTheme);
        }
      });

      // Listen for theme changes in other tabs/windows
      window.addEventListener("storage", function (e) {
        if (e.key === "appTheme") {
          applyTheme(e.newValue);
        }
      });

      document.addEventListener("DOMContentLoaded", function () {
        const notesPopup = document.getElementById("notesPopup");
        const openNotes = document.getElementById("openNotes");
        const closeNotes = document.getElementById("closeNotes");
        const notesText = document.getElementById("notesText");

        const savedNotes = localStorage.getItem("quickNotes");
        if (savedNotes) {
          notesText.value = savedNotes;
        }

        openNotes.addEventListener("click", function () {
          console.log("Open notes button clicked");
          notesPopup.style.display = "flex";
        });

        closeNotes.addEventListener("click", function () {
          notesPopup.style.display = "none";
          localStorage.setItem("quickNotes", notesText.value);
        });

        notesText.addEventListener("input", function () {
          localStorage.setItem("quickNotes", notesText.value);
        });

        document.addEventListener("click", function (event) {
          if (
            !notesPopup.contains(event.target) &&
            event.target !== openNotes
          ) {
            notesPopup.style.display = "none";
            localStorage.setItem("quickNotes", notesText.value);
          }
        });
      });
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Manager</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      :root {
        --bg-color: #f4f4f4;
        --text-color: #333;
        --btn-color: #28a745;
        --btn-hover: #218838;
        --container-bg: white;
        --nav-bg: white;
        --border-color: #ddd;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --logo-color: #4a90e2;
      }

      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        padding-top: 80px;
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: all 0.3s ease;
      }

      .navbar {
        background: var(--nav-bg);
        box-shadow: 0 2px 10px var(--shadow-color);
        padding: 1rem 2rem;
        position: fixed;
        width: 100%;
        top: 0;
        left: 0;
        z-index: 1000;
        box-sizing: border-box;
      }

      .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--logo-color);
        text-decoration: none;
      }

      .nav-links {
        display: flex;
        gap: 2rem;
      }

      .nav-links a {
        text-decoration: none;
        color: var(--text-color);
        font-weight: 500;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        transition: all 0.3s ease;
      }

      .nav-links a:hover {
        background: var(--bg-color);
        color: var(--btn-color);
      }

      .icon {
        margin-right: 8px;
        font-size: 1.2em;
      }

      .file-manager {
        max-width: 1000px;
        margin: 20px auto;
        padding: 20px;
        background: var(--container-bg);
        border-radius: 8px;
        box-shadow: 0 0 10px var(--shadow-color);
      }

      .folder,
      .file {
        background: var(--container-bg);
        border: 1px solid var(--border-color);
        margin: 10px 0;
        padding: 15px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .folder:hover,
      .file:hover {
        background: var(--bg-color);
        transform: translateY(-2px);
        box-shadow: 0 2px 8px var(--shadow-color);
      }

      .upload-btn {
        background: var(--btn-color);
        color: white;
        border: none;
        padding: 5px 15px;
        border-radius: 4px;
        cursor: pointer;
        margin-left: auto;
      }

      .upload-btn:hover {
        background: var(--btn-hover);
      }

      .floating-button {
        position: fixed;
        right: 20px;
        background-color: var(--btn-color);
        color: white;
        border: none;
        padding: 0 20px;
        height: 40px;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 2px 2px 10px var(--shadow-color);
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
        transition: all 0.3s ease;
      }

      .floating-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px var(--shadow-color);
      }

      .notes-button {
        bottom: 20px;
        background-color: #2196f3; /* Blue color for distinction */
      }

      .notes-button::before {
        content: "üìù";
        font-size: 20px;
      }

      .notes-button::after {
        content: "Quick Notes";
        color: white;
        font-weight: 500;
      }

      .notes-popup {
        bottom: 70px;
        right: 20px;
        width: 300px;
        height: 300px;
        background: var(--container-bg);
        border-radius: 8px;
        box-shadow: 2px 2px 10px var(--shadow-color);
        display: none;
        flex-direction: column;
        padding: 15px;
        z-index: 1000;
        border: 1px solid var(--border-color);
      }

      .notes-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: bold;
        margin-bottom: 10px;
        color: var(--text-color);
      }

      .notes-header button {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
        color: var(--text-color);
      }

      #notesText {
        width: 100%;
        height: calc(100% - 30px);
        border: 1px solid var(--border-color);
        resize: none;
        outline: none;
        padding: 10px;
        border-radius: 4px;
        background: var(--container-bg);
        color: var(--text-color);
      }

      #file-list {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        padding: 0;
        list-style: none;
      }

      .folder,
      .file {
        width: 120px;
        height: 140px;
        padding: 10px;
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        background: var(--container-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .folder:hover,
      .file:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px var(--shadow-color);
      }

      .folder img,
      .file img {
        width: 48px;
        height: 48px;
        margin-bottom: 8px;
      }

      .folder span,
      .file span {
        font-size: 0.9em;
        word-break: break-word;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }

      .file-count {
        font-size: 0.8em;
        color: var(--text-secondary);
        margin-top: 4px;
      }

      .add-file-btn {
        width: 120px;
        height: 140px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border: 2px dashed var(--border-color);
        border-radius: 8px;
        cursor: pointer;
        background: transparent;
        color: var(--text-color);
        transition: all 0.3s ease;
      }

      .add-file-btn:hover {
        background: var(--bg-color);
        border-color: var(--btn-color);
        color: var(--btn-color);
      }

      .add-file-btn i {
        font-size: 24px;
        margin-bottom: 8px;
      }

      .file-viewer {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1001;
      }

      .file-viewer-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--container-bg);
        padding: 20px;
        border-radius: 8px;
        max-width: 80%;
        max-height: 80vh;
        overflow: auto;
      }

      .file-viewer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .file-viewer-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-color);
      }

      .file-content {
        white-space: pre-wrap;
        user-select: text;
        font-family: monospace;
        line-height: 1.5;
        padding: 15px;
        background: var(--bg-color);
        border-radius: 4px;
      }

      .file-content img {
        max-width: 100%;
        height: auto;
      }

      ::selection {
        background: var(--btn-color);
        color: white;
      }

      .file-actions {
        display: none;
        position: absolute;
        top: 5px;
        right: 5px;
        background: var(--container-bg);
        border-radius: 4px;
        box-shadow: 0 2px 8px var(--shadow-color);
      }

      .file:hover .file-actions,
      .folder:hover .file-actions {
        display: flex;
      }

      .action-btn {
        background: none;
        border: none;
        padding: 4px 8px;
        cursor: pointer;
        color: var(--text-color);
        transition: all 0.2s ease;
      }

      .action-btn:hover {
        color: #dc3545;
      }

      .file,
      .folder {
        position: relative;
      }

      .delete-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1002;
        justify-content: center;
        align-items: center;
      }

      .delete-modal-content {
        background: var(--container-bg);
        padding: 20px;
        border-radius: 8px;
        max-width: 400px;
        width: 90%;
        text-align: center;
      }

      .delete-modal-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
      }

      .delete-btn {
        background: #dc3545;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
      }

      .cancel-btn {
        background: var(--btn-color);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
      }

      .upload-section {
        width: 100%;
        height: 300px;
        display: flex;
        justify-content: center;
        align-items: center;
        border: 2px dashed var(--border-color);
        border-radius: 8px;
        margin: 20px 0;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .upload-section:hover {
        border-color: var(--btn-color);
        background: var(--bg-color);
      }

      .upload-container {
        text-align: center;
        color: var(--text-color);
      }

      .upload-container i {
        font-size: 48px;
        color: var(--btn-color);
        margin-bottom: 15px;
      }

      .upload-container h3 {
        margin: 10px 0;
        font-weight: normal;
      }

      .upload-container p {
        color: var(--text-secondary);
        font-size: 0.9em;
      }

      .upload-btn-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
      }

      .upload-btn-container:hover {
        border-color: var(--btn-color);
        background: var(--bg-color);
      }

      .upload-btn-container i {
        font-size: 24px;
        margin-bottom: 8px;
        color: var(--btn-color);
      }

      #file-list {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        padding: 20px;
      }

      .floating-popup {
        display: none;
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 300px;
        background: var(--container-bg);
        border-radius: 8px;
        box-shadow: 0 4px 15px var(--shadow-color);
        z-index: 1000;
        animation: slideIn 0.5s ease-out;
        border: 1px solid var(--border-color);
      }

      @keyframes slideIn {
        from {
          transform: translateY(100%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .popup-content {
        padding: 15px;
      }

      .popup-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
      }

      .popup-header h3 {
        margin: 0;
        color: var(--text-color);
      }

      .close-popup {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-color);
        padding: 0;
        line-height: 1;
      }

      .popup-body {
        color: var(--text-color);
      }

      .popup-body ul {
        padding-left: 20px;
        margin: 10px 0;
      }

      .popup-body li {
        margin: 5px 0;
      }

      .popup-footer {
        margin-top: 15px;
        padding-top: 10px;
        border-top: 1px solid var(--border-color);
      }

      .popup-footer label {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-color);
        font-size: 0.9em;
      }

      .popup-footer input[type="checkbox"] {
        margin: 0;
      }

      .tasks-button {
        bottom: 90px;
        background-color: #4caf50;
      }

      .tasks-button::before {
        content: "üìã";
        font-size: 20px;
      }

      .tasks-button::after {
        content: "Open Tasks";
        color: white;
        font-weight: 500;
      }

      .tasks-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px var(--shadow-color);
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-container">
        <a href="landing.html" class="logo">MindSpark</a>
        <div class="nav-links">
          <a href="pomodoro.html"><i class="fas fa-clock icon"></i>Pomodoro</a>
          <a href="calendar.html"
            ><i class="far fa-calendar icon"></i>Calendar</a
          >
          <a href="notes.html"><i class="far fa-sticky-note icon"></i>Notes</a>
          <a href="filemanager.html"><i class="far fa-folder icon"></i>Files</a>
        </div>
      </div>
    </nav>

    <div class="file-manager">
      <div id="folders-container">
        <ul id="file-list"></ul>
      </div>
    </div>

    <button id="openTasks" class="floating-button tasks-button"></button>
    <button id="openNotes" class="floating-button notes-button"></button>
    <div id="notesPopup" class="notes-popup">
      <div class="notes-header">
        <span>Quick Notes</span>
        <button id="closeNotes">‚úñ</button>
      </div>
      <textarea
        id="notesText"
        placeholder="Write your notes here..."
      ></textarea>
    </div>

    <div class="file-viewer" id="fileViewer">
      <div class="file-viewer-content">
        <div class="file-viewer-header">
          <h3 id="fileViewerTitle"></h3>
          <button class="file-viewer-close" onclick="closeFileViewer()">
            √ó
          </button>
        </div>
        <div class="file-content" id="fileViewerContent"></div>
      </div>
    </div>

    <div class="delete-modal" id="deleteModal">
      <div class="delete-modal-content">
        <h3>Delete Confirmation</h3>
        <p>Are you sure you want to delete this item?</p>
        <div class="delete-modal-buttons">
          <button class="cancel-btn" onclick="cancelDelete()">Cancel</button>
          <button class="delete-btn" onclick="confirmDelete()">Delete</button>
        </div>
      </div>
    </div>

    <div id="floating-popup" class="floating-popup">
      <div class="popup-content">
        <div class="popup-header">
          <h3>Welcome!</h3>
          <button class="close-popup">&times;</button>
        </div>
        <div class="popup-body">
          <p>Welcome to the File Manager! Here you can:</p>
          <ul>
            <li>Create and organize folders</li>
            <li>Upload and manage files</li>
            <li>View files and documents</li>
            <li>Take quick notes</li>
          </ul>
          <div class="popup-footer">
            <label>
              <input type="checkbox" id="dont-show-again" /> Don't show this
              again
            </label>
          </div>
        </div>
      </div>
    </div>

    <script>
      let fileSystem = [];
      let currentFolder = null;

      // Helper Functions
      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB", "TB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      function getFileIcon(filename) {
        const extension = filename.split(".").pop().toLowerCase();
        switch (extension) {
          case "pdf":
            return "https://cdn-icons-png.flaticon.com/128/337/337976.png";
          case "doc":
          case "docx":
            return "https://cdn-icons-png.flaticon.com/128/4722/4722830.png";
          case "xls":
          case "xlsx":
            return "https://cdn-icons-png.flaticon.com/128/4722/4722892.png";
          case "txt":
            return "https://cdn-icons-png.flaticon.com/128/4381/4381486.png";
          case "png":
          case "jpg":
          case "jpeg":
          case "gif":
            return "https://cdn-icons-png.flaticon.com/128/4381/4381492.png";
          default:
            return "https://cdn-icons-png.flaticon.com/128/4381/4381506.png";
        }
      }

      // Function to render files and folders
      function renderFiles() {
        const fileList = document.getElementById("file-list");
        fileList.innerHTML = "";

        if (currentFolder === null) {
          // Add the "Add Folder" button
          const addFolderBtn = document.createElement("button");
          addFolderBtn.className = "add-file-btn";
          addFolderBtn.innerHTML = `
            <i class="fas fa-folder-plus"></i>
            <span>New Folder</span>
          `;
          addFolderBtn.onclick = createNewFolder;
          fileList.appendChild(addFolderBtn);

          // Render folders
          fileSystem.forEach((item, index) => {
            const folderDiv = document.createElement("div");
            folderDiv.className = "folder";
            folderDiv.innerHTML = `
              <div class="file-actions">
                <button class="action-btn" onclick="event.stopPropagation(); showDeleteConfirmation('folder', ${index})">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
              <img src="https://cdn-icons-png.flaticon.com/128/3767/3767084.png" alt="Folder">
              <span>${item.name}</span>
              <span class="file-count">${item.files.length} files</span>
            `;
            folderDiv.onclick = () => openFolder(index);
            fileList.appendChild(folderDiv);
          });
        } else {
          // Add back button
          const backButton = document.createElement("button");
          backButton.className = "add-file-btn";
          backButton.innerHTML = `
            <i class="fas fa-arrow-left"></i>
            <span>Back</span>
          `;
          backButton.onclick = goBack;
          fileList.appendChild(backButton);

          // Add upload button
          const uploadButton = document.createElement("button");
          uploadButton.className = "add-file-btn";
          uploadButton.innerHTML = `
            <i class="fas fa-upload"></i>
            <span>Upload Files</span>
          `;
          uploadButton.onclick = () => handleFileUpload(currentFolder);
          fileList.appendChild(uploadButton);

          // Render files
          fileSystem[currentFolder].files.forEach((file, fileIndex) => {
            const fileDiv = document.createElement("div");
            fileDiv.className = "file";
            fileDiv.innerHTML = `
              <div class="file-actions">
                <button class="action-btn" onclick="event.stopPropagation(); showDeleteConfirmation('file', ${fileIndex})">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
              <img src="${getFileIcon(file.name)}" alt="File">
              <span>${file.name}</span>
              <span class="file-size">${formatFileSize(file.size)}</span>
            `;
            fileDiv.onclick = () => viewFile(file);
            fileList.appendChild(fileDiv);
          });
        }
      }

      function createNewFolder() {
        const folderName = prompt("Enter folder name:");
        if (folderName && folderName.trim() !== "") {
          const newFolder = {
            name: folderName.trim(),
            files: [],
          };
          fileSystem.push(newFolder);
          localStorage.setItem("fileSystem", JSON.stringify(fileSystem));
          renderFiles();
        } else if (folderName !== null) {
          alert("Folder name cannot be empty.");
        }
      }

      function openFolder(index) {
        currentFolder = index;
        renderFiles();
      }

      function goBack() {
        currentFolder = null;
        renderFiles();
      }

      function handleFileUpload(folderIndex) {
        const input = document.createElement("input");
        input.type = "file";
        input.multiple = true;

        input.addEventListener("change", function (event) {
          const files = event.target.files;

          if (files.length === 0) return;

          for (const file of files) {
            const reader = new FileReader();

            reader.onload = function (e) {
              const newFile = {
                name: file.name,
                size: file.size,
                type: file.type,
                data: e.target.result,
              };

              fileSystem[folderIndex].files.push(newFile);
              updateFileSystemStorage();
              renderFiles();
            };

            if (file.type.startsWith("text/")) {
              reader.readAsText(file);
            } else {
              reader.readAsDataURL(file);
            }
          }
        });

        input.click();
      }

      // Add file viewer functions
      function viewFile(file) {
        const viewer = document.getElementById("fileViewer");
        const title = document.getElementById("fileViewerTitle");
        const content = document.getElementById("fileViewerContent");

        title.textContent = file.name;

        if (file.type.startsWith("image/")) {
          content.innerHTML = `<img src="${file.data}" alt="${file.name}">`;
        } else if (file.type === "application/pdf") {
          content.innerHTML = `<embed src="${file.data}" type="application/pdf" width="100%" height="600px">`;
        } else {
          content.innerHTML = `
      <pre id="textFileContent">${file.data}</pre>
      <button onclick="highlightSelection()">Highlight</button>
    `;
        }

        function highlightSelection() {
          const selection = window.getSelection();
          const selectedText = selection.toString();

          if (selectedText.length > 0) {
            const textContainer = document.getElementById("textFileContent");
            const newHtml = textContainer.innerHTML.replace(
              selectedText,
              `<mark>${selectedText}</mark>`
            );
            textContainer.innerHTML = newHtml;
          }
        }

        viewer.style.display = "block";
      }

      function closeFileViewer() {
        document.getElementById("fileViewer").style.display = "none";
      }

      document
        .getElementById("fileViewer")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeFileViewer();
          }
        });

      let itemToDelete = null;

      function showDeleteConfirmation(type, index) {
        itemToDelete = { type, index };
        document.getElementById("deleteModal").style.display = "flex";
      }

      function cancelDelete() {
        document.getElementById("deleteModal").style.display = "none";
        itemToDelete = null;
      }

      function confirmDelete() {
        if (!itemToDelete) return;

        const { type, index } = itemToDelete;

        if (type === "folder") {
          fileSystem.splice(index, 1);
        } else if (type === "file" && currentFolder !== null) {
          fileSystem[currentFolder].files.splice(index, 1);
        }

        localStorage.setItem("fileSystem", JSON.stringify(fileSystem));

        document.getElementById("deleteModal").style.display = "none";
        itemToDelete = null;

        renderFiles();
      }

      document
        .getElementById("deleteModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            cancelDelete();
          }
        });

      document.addEventListener("DOMContentLoaded", function () {
        const savedFileSystem = localStorage.getItem("fileSystem");
        if (savedFileSystem) {
          fileSystem = JSON.parse(savedFileSystem);
        }
        renderFiles();
      });

      function updateFileSystemStorage() {
        localStorage.setItem("fileSystem", JSON.stringify(fileSystem));
      }

      // Floating popup functionality
      const floatingPopup = document.getElementById("floating-popup");
      const closePopupBtn = floatingPopup.querySelector(".close-popup");
      const dontShowAgain = document.getElementById("dont-show-again");

      // Check if the user has chosen to not show the popup
      const shouldShowPopup =
        localStorage.getItem("hideWelcomePopup") !== "true";

      if (shouldShowPopup) {
        // Show popup after a short delay
        setTimeout(() => {
          floatingPopup.style.display = "block";
        }, 1000);
      }

      // Close popup
      closePopupBtn.addEventListener("click", () => {
        floatingPopup.style.display = "none";
        if (dontShowAgain.checked) {
          localStorage.setItem("hideWelcomePopup", "true");
        }
      });

      // Close on click outside
      document.addEventListener("click", (e) => {
        if (
          !floatingPopup.contains(e.target) &&
          floatingPopup.style.display === "block"
        ) {
          floatingPopup.style.display = "none";
          if (dontShowAgain.checked) {
            localStorage.setItem("hideWelcomePopup", "true");
          }
        }
      });

      document.addEventListener("DOMContentLoaded", function () {
        const tasksButton = document.getElementById("openTasks");

        tasksButton.addEventListener("click", function () {
          // Open popup.html in a new window with specific dimensions
          const width = 800;
          const height = 600;
          const left = (screen.width - width) / 2;
          const top = (screen.height - height) / 2;

          window.open(
            "popup.html",
            "Tasks",
            `width=${width},
             height=${height},
             left=${left},
             top=${top},
             menubar=no,
             toolbar=no,
             location=no,
             status=no,
             resizable=yes`
          );
        });
      });
    </script>
    <script>
      function applyTheme(theme) {
        const root = document.documentElement;
        switch (theme) {
          case "dark":
            root.style.setProperty("--bg-color", "#1e1e1e");
            root.style.setProperty("--text-color", "#e0e0e0");
            root.style.setProperty("--btn-color", "#bb86fc");
            root.style.setProperty("--btn-hover", "#9965f4");
            root.style.setProperty("--container-bg", "#2d2d2d");
            root.style.setProperty("--nav-bg", "#2d2d2d");
            root.style.setProperty("--border-color", "#404040");
            root.style.setProperty("--shadow-color", "rgba(0, 0, 0, 0.3)");
            root.style.setProperty("--logo-color", "#bb86fc");
            // Reset background image
            document.body.style.backgroundImage = "none";
            break;

          case "blue":
            root.style.setProperty("--bg-color", "#e3f2fd");
            root.style.setProperty("--text-color", "#1a237e");
            root.style.setProperty("--btn-color", "#1976d2");
            root.style.setProperty("--btn-hover", "#1565c0");
            root.style.setProperty("--container-bg", "white");
            root.style.setProperty("--nav-bg", "#bbdefb");
            root.style.setProperty("--border-color", "#90caf9");
            root.style.setProperty("--shadow-color", "rgba(25, 118, 210, 0.2)");
            root.style.setProperty("--logo-color", "#1976d2");
            // Reset background image
            document.body.style.backgroundImage = "none";
            break;

          case "red":
            root.style.setProperty("--bg-color", "#ffebee");
            root.style.setProperty("--text-color", "#b71c1c");
            root.style.setProperty("--btn-color", "#d32f2f");
            root.style.setProperty("--btn-hover", "#c62828");
            root.style.setProperty("--container-bg", "white");
            root.style.setProperty("--nav-bg", "#ffcdd2");
            root.style.setProperty("--border-color", "#ef9a9a");
            root.style.setProperty("--shadow-color", "rgba(211, 47, 47, 0.2)");
            root.style.setProperty("--logo-color", "#d32f2f");
            // Reset background image
            document.body.style.backgroundImage = "none";
            break;

          case "squidgame":
            root.style.setProperty("--bg-color", "#000000");
            root.style.setProperty("--text-color", "#ffffff");
            root.style.setProperty("--btn-color", "#ff0000");
            root.style.setProperty("--btn-hover", "#cc0000");
            root.style.setProperty("--container-bg", "#1a1a1a");
            root.style.setProperty("--nav-bg", "#000000");
            root.style.setProperty("--border-color", "#ff0000");
            root.style.setProperty("--shadow-color", "rgba(255, 0, 0, 0.3)");
            root.style.setProperty("--logo-color", "#ff0000");
            // Add background image
            document.body.style.backgroundImage = "url('squid-game-bg.jpg')";
            document.body.style.backgroundSize = "cover";
            document.body.style.backgroundAttachment = "fixed";
            break;

          default: // light theme
            root.style.setProperty("--bg-color", "#f4f4f4");
            root.style.setProperty("--text-color", "#333");
            root.style.setProperty("--btn-color", "#28a745");
            root.style.setProperty("--btn-hover", "#218838");
            root.style.setProperty("--container-bg", "white");
            root.style.setProperty("--nav-bg", "white");
            root.style.setProperty("--border-color", "#ddd");
            root.style.setProperty("--shadow-color", "rgba(0, 0, 0, 0.1)");
            root.style.setProperty("--logo-color", "#4a90e2");
            // Reset background image
            document.body.style.backgroundImage = "none";
            break;
        }
      }

      // Initialize theme when page loads
      document.addEventListener("DOMContentLoaded", function () {
        const savedTheme = localStorage.getItem("appTheme");
        if (savedTheme) {
          applyTheme(savedTheme);
        }
      });

      // Listen for theme changes in other tabs/windows
      window.addEventListener("storage", function (e) {
        if (e.key === "appTheme") {
          applyTheme(e.newValue);
        }
      });

      document.addEventListener("DOMContentLoaded", function () {
        const notesPopup = document.getElementById("notesPopup");
        const openNotes = document.getElementById("openNotes");
        const closeNotes = document.getElementById("closeNotes");
        const notesText = document.getElementById("notesText");

        const savedNotes = localStorage.getItem("quickNotes");
        if (savedNotes) {
          notesText.value = savedNotes;
        }

        openNotes.addEventListener("click", function () {
          console.log("Open notes button clicked");
          notesPopup.style.display = "flex";
        });

        closeNotes.addEventListener("click", function () {
          notesPopup.style.display = "none";
          localStorage.setItem("quickNotes", notesText.value);
        });

        notesText.addEventListener("input", function () {
          localStorage.setItem("quickNotes", notesText.value);
        });

        document.addEventListener("click", function (event) {
          if (
            !notesPopup.contains(event.target) &&
            event.target !== openNotes
          ) {
            notesPopup.style.display = "none";
            localStorage.setItem("quickNotes", notesText.value);
          }
        });
      });
    </script>
  </body>
</html>
